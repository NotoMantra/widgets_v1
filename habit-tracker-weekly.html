<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>7-Day Habit Tracker</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #f3f0ff 0%, #e8e4ff 100%);
            min-height: 100vh;
            padding: 16px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 32px;
        }

        .header h1 {
            font-size: 2rem;
            font-weight: bold;
            color: #5b4b8a;
            margin-bottom: 8px;
        }

        .date-display {
            display: flex;
            align-items: center;
            justify-content: center;
            color: #8b7dc3;
            font-size: 1.125rem;
        }

        .date-icon {
            width: 20px;
            height: 20px;
            margin-right: 8px;
        }

        .add-section {
            background: white;
            border-radius: 16px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
            border: 1px solid #e8e4ff;
            padding: 24px;
            margin-bottom: 24px;
        }

        .add-button {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            padding: 12px 16px;
            border: 2px dashed #d8d0ff;
            border-radius: 12px;
            background: transparent;
            color: #8b7dc3;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 1rem;
        }

        .add-button:hover {
            background: #f8f6ff;
            border-color: #c4b5ff;
        }

        .add-form {
            display: none;
        }

        .add-form.active {
            display: block;
        }

        .add-form input {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid #d8d0ff;
            border-radius: 12px;
            font-size: 1rem;
            margin-bottom: 16px;
            outline: none;
            transition: all 0.2s;
        }

        .add-form input:focus {
            border-color: #8b7dc3;
            box-shadow: 0 0 0 3px rgba(139, 125, 195, 0.1);
        }

        .button-group {
            display: flex;
            gap: 12px;
        }

        .btn {
            flex: 1;
            padding: 10px 16px;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.2s;
        }

        .btn-primary {
            background: #8b7dc3;
            color: white;
        }

        .btn-primary:hover {
            background: #7a6bb8;
        }

        .btn-secondary {
            background: #f3f4f6;
            color: #6b7280;
        }

        .btn-secondary:hover {
            background: #e5e7eb;
        }

        .empty-state {
            background: white;
            border-radius: 16px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
            border: 1px solid #e8e4ff;
            padding: 48px;
            text-align: center;
        }

        .empty-icon {
            width: 64px;
            height: 64px;
            color: #d8d0ff;
            margin: 0 auto 16px;
        }

        .empty-state h3 {
            font-size: 1.25rem;
            font-weight: 600;
            color: #5b4b8a;
            margin-bottom: 8px;
        }

        .empty-state p {
            color: #8b7dc3;
        }

        .habits-list {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .habit-card {
            background: white;
            border-radius: 16px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
            border: 1px solid #e8e4ff;
            padding: 24px;
            transition: all 0.2s;
        }

        .habit-card.completed {
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            border-color: #7dd3fc;
        }

        .habit-card:hover {
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.07);
        }

        .habit-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
        }

        .habit-name {
            font-size: 1.25rem;
            font-weight: 600;
            color: #374151;
        }

        .action-buttons {
            display: flex;
            gap: 4px;
        }

        .action-button {
            padding: 8px;
            background: transparent;
            border: none;
            color: #9ca3af;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.2s;
        }

        .edit-button:hover {
            background: #f0f9ff;
            color: #3b82f6;
        }

        .delete-button:hover {
            background: #fef2f2;
            color: #ef4444;
        }

        .progress-section {
            margin-bottom: 20px;
        }

        .progress-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .progress-text {
            font-size: 1.125rem;
            font-weight: 600;
            color: #5b4b8a;
        }

        .cycle-status {
            font-size: 0.875rem;
            color: #8b7dc3;
        }

        .progress-bar {
            display: flex;
            gap: 4px;
            margin-bottom: 16px;
        }

        .progress-dot {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: #e5e7eb;
            transition: all 0.3s;
        }

        .progress-dot.completed {
            background: #8b7dc3;
            transform: scale(1.1);
        }

        .progress-dot.missed {
            background: #a855f7;
            border: 2px solid #9333ea;
        }

        .progress-dot.today {
            border: 2px solid #8b7dc3;
            background: #f3f0ff;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
            margin-bottom: 20px;
        }

        .stat {
            text-align: center;
            padding: 12px;
            background: #f8f6ff;
            border-radius: 8px;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #5b4b8a;
        }

        .stat-label {
            font-size: 0.75rem;
            color: #8b7dc3;
            text-transform: uppercase;
            font-weight: 500;
        }

        .action-section {
            display: flex;
            gap: 12px;
        }

        .complete-btn {
            flex: 1;
            padding: 12px 24px;
            background: #8b7dc3;
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }

        .complete-btn:hover {
            background: #7a6bb8;
            transform: translateY(-1px);
        }

        .complete-btn:disabled {
            background: #d1d5db;
            color: #9ca3af;
            cursor: not-allowed;
            transform: none;
        }

        .reset-btn {
            padding: 12px 24px;
            background: #10b981;
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }

        .reset-btn:hover {
            background: #059669;
        }

        .celebration {
            text-align: center;
            padding: 20px;
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            border-radius: 12px;
            margin-bottom: 20px;
        }

        .celebration h3 {
            font-size: 1.25rem;
            margin-bottom: 8px;
        }

        .edit-input {
            font-size: 1.25rem;
            font-weight: 600;
            padding: 8px 12px;
            border: 1px solid #8b7dc3;
            border-radius: 8px;
            outline: none;
            box-shadow: 0 0 0 3px rgba(139, 125, 195, 0.1);
        }

        .edit-buttons {
            display: flex;
            gap: 8px;
            margin-left: 12px;
        }

        .edit-save-btn, .edit-cancel-btn {
            padding: 6px 12px;
            border: none;
            border-radius: 6px;
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .edit-save-btn {
            background: #8b7dc3;
            color: white;
        }

        .edit-save-btn:hover {
            background: #7a6bb8;
        }

        .edit-cancel-btn {
            background: #f3f4f6;
            color: #6b7280;
        }

        .edit-cancel-btn:hover {
            background: #e5e7eb;
        }

        .footer {
            text-align: center;
            margin-top: 32px;
            color: #8b7dc3;
            font-size: 0.875rem;
        }

        .icon {
            display: inline-block;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>7-Day Habit Tracker</h1>
            <div class="date-display">
                <svg class="date-icon icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                </svg>
                <span id="currentDate"></span>
            </div>
        </div>

        <!-- Add Habit Section -->
        <div class="add-section">
            <button class="add-button" id="addButton">
                <svg class="icon" style="width: 20px; height: 20px; margin-right: 8px;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                </svg>
                Add New 7-Day Habit
            </button>
            <div class="add-form" id="addForm">
                <input type="text" id="habitInput" placeholder="Enter habit name..." />
                <div class="button-group">
                    <button class="btn btn-primary" id="saveButton">Start 7-Day Challenge</button>
                    <button class="btn btn-secondary" id="cancelButton">Cancel</button>
                </div>
            </div>
        </div>

        <!-- Habits Container -->
        <div id="habitsContainer">
            <!-- Empty state -->
            <div class="empty-state" id="emptyState">
                <svg class="empty-icon icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z"></path>
                </svg>
                <h3>No habits yet</h3>
                <p>Start your first 7-day habit challenge!</p>
            </div>
            <div class="habits-list" id="habitsList" style="display: none;"></div>
        </div>

        <!-- Footer -->
        <div class="footer">
            Built with 💜 for 7-day consistency
        </div>
    </div>

    <script>
        // Global state
        let habits = [];
        let showAddForm = false;
        let editingId = null;

        // Get today's date string
        function getTodayString() {
            return new Date().toISOString().split('T')[0];
        }

        // Format date for display
        function formatDate() {
            const options = { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            };
            return new Date().toLocaleDateString('en-US', options);
        }

        // Get days difference between two dates
        function getDaysDifference(date1, date2) {
            const oneDay = 24 * 60 * 60 * 1000;
            const firstDate = new Date(date1);
            const secondDate = new Date(date2);
            return Math.round((secondDate - firstDate) / oneDay);
        }



        // Reset habit cycle
        function resetHabitCycle(habitId) {
            habits = habits.map(habit => {
                if (habit.id === habitId) {
                    return {
                        ...habit,
                        startDate: getTodayString(),
                        completions: [],
                        currentProgress: 0,
                        currentStreak: 0,
                        isComplete: false
                    };
                }
                return habit;
            });
        }

        // Get date string for a specific day offset from start date
        function getDateString(startDate, dayOffset) {
            const date = new Date(startDate);
            date.setDate(date.getDate() + dayOffset);
            return date.toISOString().split('T')[0];
        }

        // Check if today is completed
        function isCompletedToday(habit) {
            const today = getTodayString();
            return habit.completions?.includes(today) || false;
        }

        // Get current day number in the cycle (1-7)
        function getCurrentDayNumber(habit) {
            const today = getTodayString();
            const startDate = habit.startDate;
            const daysDiff = getDaysDifference(startDate, today);
            
            // If more than 7 days passed, cycle is over
            if (daysDiff >= 7) return 8; // Beyond cycle
            
            return daysDiff + 1; // Day 1-7
        }

        // Get habit progress with missed days tracking
        function getHabitProgress(habit) {
            const today = getTodayString();
            const currentDayNumber = getCurrentDayNumber(habit);
            const progress = [];
            
            for (let day = 1; day <= 7; day++) {
                const dayDate = getDateString(habit.startDate, day - 1);
                const isCompleted = habit.completions?.includes(dayDate);
                const isToday = dayDate === today;
                const isPast = new Date(dayDate) < new Date(today);
                
                let status = 'pending';
                if (isCompleted) {
                    status = 'completed';
                } else if (isPast && !isCompleted) {
                    status = 'missed';
                } else if (isToday) {
                    status = 'today';
                }
                
                progress.push({
                    day,
                    date: dayDate,
                    status,
                    isCompleted
                });
            }
            
            return progress;
        }

        // Calculate current streak (consecutive days from start)
        function calculateCurrentStreak(habit) {
            const progress = getHabitProgress(habit);
            let streak = 0;
            
            for (let i = 0; i < progress.length; i++) {
                if (progress[i].status === 'completed') {
                    streak++;
                } else if (progress[i].status === 'missed') {
                    break; // Streak broken
                } else if (progress[i].status === 'today') {
                    break; // Haven't reached today yet
                }
            }
            
            return streak;
        }

        // Check if habit cycle is broken (any missed days)
        function isCycleBroken(habit) {
            const progress = getHabitProgress(habit);
            return progress.some(day => day.status === 'missed');
        }

        // Load habits from localStorage
        function loadHabits() {
            const saved = localStorage.getItem('habitTracker7Day');
            if (saved) {
                habits = JSON.parse(saved);
            }
        }

        // Save habits to localStorage
        function saveHabits() {
            localStorage.setItem('habitTracker7Day', JSON.stringify(habits));
        }

        // Add new habit
        function addHabit() {
            const input = document.getElementById('habitInput');
            const name = input.value.trim();
            
            if (!name) return;
            
            const habit = {
                id: Date.now(),
                name: name,
                startDate: getTodayString(),
                completions: [],
                currentProgress: 0,
                currentStreak: 0,
                bestStreak: 0,
                isComplete: false
            };
            
            habits.push(habit);
            input.value = '';
            toggleAddForm();
            saveHabits();
            renderHabits();
        }

        // Delete habit
        function deleteHabit(id) {
            habits = habits.filter(h => h.id !== id);
            saveHabits();
            renderHabits();
        }

        // Complete habit for today
        function completeHabit(id) {
            const today = getTodayString();
            
            habits = habits.map(habit => {
                if (habit.id === id) {
                    // Don't allow if already completed today
                    if (habit.completions?.includes(today)) {
                        return habit;
                    }
                    
                    // Add today to completions
                    const newCompletions = [...(habit.completions || []), today];
                    
                    // Calculate new progress
                    const progress = getHabitProgress({...habit, completions: newCompletions});
                    const completedCount = progress.filter(p => p.status === 'completed').length;
                    const currentStreak = calculateCurrentStreak({...habit, completions: newCompletions});
                    const isComplete = completedCount >= 7 && !progress.some(p => p.status === 'missed');
                    
                    return {
                        ...habit,
                        completions: newCompletions,
                        currentProgress: completedCount,
                        currentStreak: currentStreak,
                        bestStreak: Math.max(habit.bestStreak || 0, currentStreak),
                        isComplete: isComplete
                    };
                }
                return habit;
            });
            
            saveHabits();
            renderHabits();
        }

        // Reset habit to start new cycle
        function resetHabit(id) {
            if (confirm('Start a new 7-day cycle for this habit?')) {
                resetHabitCycle(id);
                saveHabits();
                renderHabits();
            }
        }

        // Start editing a habit
        function startEdit(id) {
            editingId = id;
            renderHabits();
            setTimeout(() => {
                const input = document.querySelector('.edit-input');
                if (input) input.select();
            }, 0);
        }

        // Save habit edit
        function saveEdit(id) {
            const input = document.querySelector('.edit-input');
            const newName = input.value.trim();
            
            if (!newName) {
                cancelEdit();
                return;
            }
            
            habits = habits.map(habit => 
                habit.id === id ? { ...habit, name: newName } : habit
            );
            
            editingId = null;
            saveHabits();
            renderHabits();
        }

        // Cancel habit edit
        function cancelEdit() {
            editingId = null;
            renderHabits();
        }

        // Check if habit is completed today
        function isCompletedToday(habit) {
            return habit.completions?.includes(getTodayString()) || false;
        }

        // Toggle add form
        function toggleAddForm() {
            const addButton = document.getElementById('addButton');
            const addForm = document.getElementById('addForm');
            const input = document.getElementById('habitInput');
            
            showAddForm = !showAddForm;
            
            if (showAddForm) {
                addButton.style.display = 'none';
                addForm.classList.add('active');
                input.focus();
            } else {
                addButton.style.display = 'flex';
                addForm.classList.remove('active');
                input.value = '';
            }
        }

        // Render habits
        function renderHabits() {
            const emptyState = document.getElementById('emptyState');
            const habitsList = document.getElementById('habitsList');
            
            if (habits.length === 0) {
                emptyState.style.display = 'block';
                habitsList.style.display = 'none';
                return;
            }
            
            emptyState.style.display = 'none';
            habitsList.style.display = 'flex';
            
            habitsList.innerHTML = habits.map(habit => {
                const completedToday = isCompletedToday(habit);
                const progress = getHabitProgress(habit);
                const currentStreak = calculateCurrentStreak(habit);
                const completedCount = progress.filter(p => p.status === 'completed').length;
                const completionPercentage = Math.round((completedCount / 7) * 100);
                const isEditing = editingId === habit.id;
                const currentDay = getCurrentDayNumber(habit);
                const isCycleOver = currentDay > 7;
                const hasMissedDays = progress.some(p => p.status === 'missed');
                
                // Create progress dots with proper coloring
                const progressDots = progress.map(dayProgress => {
                    let cssClass = 'progress-dot';
                    
                    if (dayProgress.status === 'completed') {
                        cssClass += ' completed';
                    } else if (dayProgress.status === 'missed') {
                        cssClass += ' missed';
                    } else if (dayProgress.status === 'today') {
                        cssClass += ' today';
                    }
                    
                    return `<div class="${cssClass}"></div>`;
                }).join('');
                
                return `
                    <div class="habit-card ${habit.isComplete ? 'completed' : ''}">
                        <div class="habit-header">
                            ${isEditing ? `
                                <input type="text" class="edit-input" value="${habit.name}" 
                                       onkeypress="if(event.key==='Enter') saveEdit(${habit.id}); if(event.key==='Escape') cancelEdit();" />
                                <div class="edit-buttons">
                                    <button class="edit-save-btn" onclick="saveEdit(${habit.id})">Save</button>
                                    <button class="edit-cancel-btn" onclick="cancelEdit()">Cancel</button>
                                </div>
                            ` : `
                                <h3 class="habit-name">${habit.name}</h3>
                                <div class="action-buttons">
                                    <button class="action-button edit-button" onclick="startEdit(${habit.id})">
                                        <svg class="icon" style="width: 16px; height: 16px;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                                        </svg>
                                    </button>
                                    <button class="action-button delete-button" onclick="deleteHabit(${habit.id})">
                                        <svg class="icon" style="width: 16px; height: 16px;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                                        </svg>
                                    </button>
                                </div>
                            `}
                        </div>
                        
                        ${!isEditing ? `
                            ${habit.isComplete && !hasMissedDays ? `
                                <div class="celebration">
                                    <h3>🎉 7-Day Cycle Complete!</h3>
                                    <p>Amazing work! You've completed your habit for 7 consecutive days.</p>
                                </div>
                            ` : hasMissedDays ? `
                                <div class="celebration" style="background: linear-gradient(135deg, #a855f7, #9333ea);">
                                    <h3>💜 Keep Going!</h3>
                                    <p>Purple dots show missed days, but you're still building the habit!</p>
                                </div>
                            ` : ''}
                            
                            <div class="progress-section">
                                <div class="progress-header">
                                    <div class="progress-text">${completedCount}/7 Days</div>
                                    <div class="cycle-status">
                                        ${hasMissedDays ? 'Building Habit' : isCycleOver ? 'Cycle Complete' : `Day ${currentDay} - Started ${new Date(habit.startDate).toLocaleDateString()}`}
                                    </div>
                                </div>
                                <div class="progress-bar">
                                    ${progressDots}
                                </div>
                            </div>
                            
                            <div class="stats-grid">
                                <div class="stat">
                                    <div class="stat-value">${habit.bestStreak || 0}</div>
                                    <div class="stat-label">Best Streak</div>
                                </div>
                                <div class="stat">
                                    <div class="stat-value">${currentStreak}</div>
                                    <div class="stat-label">Current Streak</div>
                                </div>
                            </div>
                            
                            <div class="action-section">
                                ${habit.isComplete || isCycleOver ? `
                                    <button class="reset-btn" onclick="resetHabit(${habit.id})">
                                        Start New 7-Day Cycle
                                    </button>
                                ` : `
                                    <button class="complete-btn" onclick="completeHabit(${habit.id})" 
                                            ${completedToday ? 'disabled' : ''}>
                                        ${completedToday ? '✅ Completed Today' : 'Complete Today'}
                                    </button>
                                `}
                            </div>
                        ` : ''}
                    </div>
                `;
            }).join('');
        }

        // Initialize app
        function init() {
            // Set current date
            document.getElementById('currentDate').textContent = formatDate();
            
            // Load saved habits
            loadHabits();
            
            // Set up event listeners
            document.getElementById('addButton').addEventListener('click', toggleAddForm);
            document.getElementById('saveButton').addEventListener('click', addHabit);
            document.getElementById('cancelButton').addEventListener('click', toggleAddForm);
            
            // Handle Enter key in input
            document.getElementById('habitInput').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    addHabit();
                }
            });
            
            // Initial render
            renderHabits();
        }

        // Start the app when page loads
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>